"use strict";(()=>{var e={};e.id=54,e.ids=[54],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5613:e=>{e.exports=import("@google/genai")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},7125:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{config:()=>u,default:()=>p,routeModule:()=>d});var a=n(1802),i=n(7153),s=n(6249),o=n(112),l=e([o]);o=(l.then?(await l)():l)[0];let p=(0,s.l)(o,"default"),u=(0,s.l)(o,"config"),d=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/supplemental_info",pathname:"/api/supplemental_info",bundlePath:"",filename:""},userland:o});r()}catch(e){r(e)}})},112:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{default:()=>s});var a=n(5613),i=e([a]);a=(i.then?(await i)():i)[0];let o=process.env.GEMINI_API_KEY,l=o?new a.GoogleGenAI({apiKey:o}):null;o||console.warn("GEMINI_API_KEY environment variable is not set. API calls will fail.");let p={type:a.Type.OBJECT,properties:{category:{type:a.Type.STRING,description:"要求された情報のカテゴリ（例: vital, lab, physical）。"},data:{type:a.Type.STRING,description:"生成された架空のデータ、またはアセスメント結果をカルテ記載に適した形式で記載。"},note:{type:a.Type.STRING,description:"そのデータが現在の患者の病態に与える影響についての簡潔なコメント。"}},required:["category","data","note"]};async function s(e,t){if("OPTIONS"===e.method){t.status(200).end();return}if("POST"!==e.method){t.status(405).json({message:"Method Not Allowed"});return}if(!l)return t.status(503).json({message:"AI Engine Not Initialized. Missing GEMINI_API_KEY."});let{fullText:n,infoCategory:r}=e.body;if(!n||!r)return t.status(400).json({message:"Missing required fields: fullText (current chart) or infoCategory (vital/lab/physical)."});try{let e={vital:"バイタルサイン (体温, 血圧, 脈拍, 呼吸数, SpO2, 意識レベル) の結果",physical:"主要なフィジカルアセスメント (胸部, 腹部, 神経学的所見) の結果",lab:"緊急血液検査 (WBC, Hb, CRP, Na, K, Creなど) の結果"}[r]||"追加で必要な検査やアセスメント情報",a=`
            あなたは臨床研修指導医であり、研修医の求めに応じて、現在のカルテ記載の文脈に最も関連性の高い架空の臨床データを生成する役割を持っています。
            提供されたカルテ記載を読み、病態に矛盾しない、かつ研修医が修正に利用しやすい具体的な${e}を生成し、JSON形式で出力してください。
            結果は簡潔に、カルテ記載にすぐに利用できる形式（例: "BP 130/80mmHg, HR 95bpm, SpO2 96%(RA)"）で記載し、絶対に必要な情報のみを含めてください。
            注釈(note)には、そのデータが現在の病態をどのように裏付け/否定するか、簡潔な臨床的ヒントを記載してください。
        `,i=`
            現在のカルテ記載:

${n}

この記載に基づき、研修医が「${e}」を求めています。病態に最も適した架空の結果を生成してください。
        `,s=await l.models.generateContent({model:"gemini-2.5-flash",contents:[{role:"user",parts:[{text:i}]}],config:{systemInstruction:{parts:[{text:a}]},responseMimeType:"application/json",responseSchema:p}}),o=s.candidates?.[0]?.content?.parts?.[0]?.text;if(!o)return t.status(500).json({message:"AI did not return a valid JSON response."});let u=JSON.parse(o);t.status(200).json(u)}catch(e){console.error("Gemini API error in supplemental_info:",e),t.status(500).json({message:"Internal server error during info generation."})}}r()}catch(e){r(e)}})},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=7125);module.exports=n})();